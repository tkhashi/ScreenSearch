# Feature Specification: macOSキーボードクリック支援MVP

**Feature Branch**: `001-macos-click-assist`  
**Created**: 2026-02-23  
**Status**: Draft  
**Input**: User description: "MVP: macOS Screen Search風 キーボードクリック支援ツール（アクティブウィンドウ限定）"

## Constitution Alignment *(mandatory)*

- 本機能は「マウスなしでUI要素を操作する」というMVP価値を最短で検証するための範囲に限定する。
- 対象範囲は macOS のアクティブウィンドウ内に限定し、全画面網羅や他OS対応は含めない。
- 実装不能またはコスト過大と判定した場合は、強行せずに顧客へ要件変更案を提示して合意後に継続する。
- ドキュメント、検証手順、ログ説明、運用記録は日本語で記載する。
- タスク分解、優先順位管理、進捗更新はエージェント主導で実施する。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 操作候補の抽出確認 (Priority: P1)

利用者として、起動中の対象画面から操作候補が取得できることを確認したい。これにより「キーボード操作の土台」が成立しているかを最初に判断できる。

**Why this priority**: 候補抽出が失敗するとクリック実行も成立しないため、最優先で可否確認する。

**Independent Test**: 対象アプリを前面にしてツールを起動し、候補件数と候補座標のサンプルが出力されれば単独価値を確認できる。

**Acceptance Scenarios**:

1. **Given** 利用者が対象アプリのウィンドウを前面表示している, **When** ツールを起動する, **Then** 権限状態、対象アプリ情報、フォーカスウィンドウ有無、候補件数がログに表示される。
2. **Given** 対象アプリが候補を持つ画面である, **When** 候補抽出を実行する, **Then** 候補の役割・名称・座標サンプルが一定件数ログに表示される。

---

### User Story 2 - キーボードで左/右クリック実行 (Priority: P2)

利用者として、候補をキーボード入力で選択し、左クリックまたは右クリックを実行したい。これによりマウスを使わずに主要操作ができる。

**Why this priority**: ユーザー価値の中心は「選択して操作できること」のため、候補抽出の次に優先する。

**Independent Test**: 候補抽出済み状態で候補を選択してクリックを実行し、対象アプリ側の反応とクリック座標ログを確認できれば単独で検証可能。

**Acceptance Scenarios**:

1. **Given** 候補が表示されている, **When** 利用者が候補を指定して左クリックを実行する, **Then** 指定候補の座標で左クリックが実行される。
2. **Given** 候補が表示されている, **When** 利用者が候補を指定して右クリックを実行する, **Then** 指定候補の座標で右クリックが実行される。

---

### User Story 3 - ホットキー起点の一連フロー (Priority: P3)

利用者として、ホットキーで開始して候補表示・入力選択・クリック実行・終了までを一連で完了したい。これにより日常作業で継続利用できる。

**Why this priority**: 体験完成度を上げる段階だが、P1/P2 が成立してからでも価値提供できるため P3 とする。

**Independent Test**: ホットキー開始から終了までを1回通しで実行し、操作成功とログ整合を確認できれば単独で検証可能。

**Acceptance Scenarios**:

1. **Given** 対象アプリが前面である, **When** 利用者がホットキーを押して候補選択後に実行する, **Then** クリック完了後にセッションが終了し次回起動可能な状態に戻る。

### Edge Cases

- 操作権限が未許可の場合、実行を継続せず、必要な許可手順を明示する。
- 前面ウィンドウが取得できない場合、原因カテゴリ（対象なし/アクセス不可/一時失敗）をログに分離して出す。
- 候補件数が 0 件の場合、クリック実行を受け付けず、候補なしメッセージを表示する。
- 候補の座標が画面外または無効な場合、対象候補を除外し除外理由をログに残す。
- 実行中に対象アプリが切り替わった場合、そのセッションを中断して再取得を促す。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは起動時に操作権限の可否を判定し、結果を `true/false` で表示しなければならない。
- **FR-002**: システムは前面アプリ識別情報と対象ウィンドウ有無を取得し、ログ出力しなければならない。
- **FR-003**: システムは前面ウィンドウ配下の操作候補を列挙し、候補数を出力しなければならない。
- **FR-004**: システムは候補ごとに役割・表示名・位置サイズ情報を取得し、上位サンプルを出力しなければならない。
- **FR-005**: システムは候補へ短いラベルを割り当て、入力接頭辞で候補を絞り込めなければならない。
- **FR-006**: 利用者はラベル指定で候補を1件選択できなければならない。
- **FR-007**: システムは選択候補に対して左クリック相当を実行できなければならない。
- **FR-008**: システムは選択候補に対して右クリック相当を実行できなければならない。
- **FR-009**: システムはクリック実行時に座標とクリック種別をログ出力しなければならない。
- **FR-010**: システムはホットキー開始から実行完了までを1セッションとして処理し、完了後に終了状態へ戻らなければならない。
- **FR-011**: システムは失敗時に、権限・対象取得・候補抽出・クリック実行のどこで失敗したかを識別可能なログを出さなければならない。
- **FR-012**: システムは各開発サイクルで `What / Why / How to test / Expected / Logs` を提示できる状態を維持しなければならない。
- **FR-013**: システムは対象範囲を macOS のアクティブウィンドウ内に限定し、非対象（他OS、画像認識ベース検出、アクセシビリティ非対応領域）を本MVPに含めてはならない。

### Key Entities *(include if feature involves data)*

- **操作セッション**: 1回の起動から終了までの処理単位。開始時刻、対象アプリ情報、結果状態を持つ。
- **操作候補**: 操作可能な画面要素。ラベル、役割、名称、座標情報、有効状態を持つ。
- **クリック要求**: 利用者の実行指示。対象ラベル、クリック種別、実行時刻を持つ。
- **診断ログ項目**: 実行過程の観測情報。環境情報、対象情報、抽出件数、失敗カテゴリ、実行結果を持つ。

## Assumptions

- 初期検証は単一ユーザーのローカル実行環境で行う。
- 対象アプリは一般的なデスクトップUIを提供し、操作候補が取得可能である。
- 本仕様はMVPとして、配布・署名・自動更新・高度な設定画面を対象外とする。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 権限判定、対象取得、候補抽出の3項目が、対象アプリ2種類以上で連続3回すべてログ確認できる。
- **SC-002**: 候補抽出フェーズで、対象アプリ2種類以上において各1回以上、10件以上の候補座標が取得できる。
- **SC-003**: 左クリック実行と右クリック実行が、対象アプリ1種類以上でそれぞれ1回以上成功する。
- **SC-004**: 一連フロー（開始→候補提示→選択→クリック→終了）を、利用者が1分以内で完了できる。
- **SC-005**: 失敗ケース発生時に、原因カテゴリ（権限/対象取得/候補抽出/クリック実行）がログのみで特定できる。
